<div class="reset-container">
  <!-- Header avec logo -->
  <app-logo></app-logo>

  <!-- Card principale d'inscription -->
  <div class="main-card">
    <div class="card-header">
      <h2 class="card-title">Réinitialiser le mot de passe</h2>
      <p class="card-subtitle">Définissez votre nouveau mot de passe</p>
    </div>

    <div class="card-content">
      <form class="reset-form" [formGroup]="pwdForm" (ngSubmit)="onSubmit()">
        <div class="field-section">
          <mat-form-field appearance="outline" class="col">
            <mat-label>Nouveau mot de passe</mat-label>
            <input matInput [type]="hidePassword ? 'password' : 'text'"
                   formControlName="password" required>
            <mat-hint>Minimum 8 caractères avec minuscule, majuscule, chiffre et caractère spécial</mat-hint>
            <mat-error *ngIf="passwordCtrl.touched && passwordCtrl.invalid">
              {{ getPasswordErrorMessage() }}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="col">
            <mat-label>Confirmer le mot de passe</mat-label>
            <input matInput [type]="hideConfirmPassword ? 'password' : 'text'"
                   formControlName="confirmPassword" required>
            <mat-error *ngIf="confirmPasswordCtrl.invalid">
              {{ getConfirmPasswordErrorMessage() }}
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Indicateur de force du mot de passe -->
        <div class="password-strength" *ngIf="passwordCtrl.value && passwordCtrl.dirty">
          <div class="password-strength-label">
            Force du mot de passe :
            <span [class]="'strength-' + passwordStrength.color">
              {{ passwordStrength.label }}
            </span>
          </div>
          <div class="password-strength-bar">
            <div
              class="strength-indicator"
              [style.width.%]="(passwordStrength.score || 0) * 16.66"
              [class]="'strength-' + passwordStrength.color">
            </div>
          </div>
        </div>

        <!-- Message d'erreur général -->
        <div class="form-error-message" *ngIf="pwdForm.errors?.['passwordMismatch'] &&
              (confirmPasswordCtrl.touched)">
          <mat-icon>error_outline</mat-icon>
          <span>Les mots de passe ne correspondent pas</span>
        </div>

        <!-- Actions -->
        <div class="actions">
          <button
            type="submit"
            class="btn btn--primary"
            [disabled]="pwdForm.invalid || (loading$ | async)"
            [attr.aria-busy]="(loading$ | async)">
            <mat-spinner diameter="20" *ngIf="loading$ | async"></mat-spinner>
            <i *ngIf="!(loading$ | async)" class='fas fa-arrows-rotate'></i>
            {{ (loading$ | async) ? 'Changement en cours...' : 'Changer le mot de passe' }}
          </button>
        </div>
      </form>
    </div>

    <!-- Barre de progression -->
    <mat-progress-bar
      *ngIf="loading$ | async"
      mode="indeterminate"
      class="loading-bar">
    </mat-progress-bar>
  </div>
</div>
