<div class="supervisor-add-container">
  <!-- Breadcrumb / Navigation -->
  <div class="breadcrumb">
    <button mat-button (click)="cancel()">
      <mat-icon>arrow_back</mat-icon>
      Retour à la liste
    </button>
  </div>

  <!-- En-tête -->
  <div class="header">
    <div class="header-content">
      <h1>{{ editMode ? 'Modifier le superviseur' : 'Ajouter un superviseur' }}</h1>
      <p class="subtitle">
        {{ editMode ? 'Modifiez les informations du superviseur' : 'Créez un nouveau compte superviseur' }}
      </p>
    </div>
  </div>

  <!-- Formulaire -->
  <div class="card">
    <form [formGroup]="supervisorForm" (ngSubmit)="onSubmit()">
      <div class="form-layout">
        <!-- Section Informations personnelles -->
        <div class="form-section">
          <h2>
            <mat-icon>person</mat-icon>
            Informations personnelles
          </h2>

          <div class="grid-two">
            <mat-form-field appearance="outline">
              <mat-label>Prénom</mat-label>
              <input
                matInput
                type="text"
                name="firstname"
                formControlName="firstname"
                placeholder="Ex: Jean">
              <mat-error *ngIf="firstnameCtrl.invalid && firstnameCtrl.touched">
                {{ firstnameError }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Nom</mat-label>
              <input
                matInput
                type="text"
                name="lastname"
                formControlName="lastname"
                placeholder="Ex: Dupont">
              <mat-error *ngIf="lastnameCtrl.invalid && lastnameCtrl.touched">
                {{ lastnameError }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>

        <!-- Section Contact -->
        <div class="form-section">
          <h2>
            <mat-icon>contact_mail</mat-icon>
            Informations de contact
          </h2>

          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input
              matInput
              type="email"
              name="email"
              formControlName="email"
              placeholder="exemple@email.com">
            <mat-error *ngIf="emailCtrl.invalid && emailCtrl.touched">
              {{ emailError }}
            </mat-error>
            <mat-hint>Adresse email unique pour la connexion</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Téléphone</mat-label>
            <input
              matInput
              type="tel"
              formControlName="phone"
              placeholder="0123456789">
            <mat-error *ngIf="phoneCtrl.invalid && phoneCtrl.touched">
              {{ phoneError }}
            </mat-error>
            <mat-hint>10 chiffres sans espaces</mat-hint>
          </mat-form-field>
        </div>

        <!-- Section Profil -->
        <div class="form-section">
          <h2>
            <mat-icon>security</mat-icon>
            Profil et permissions
          </h2>

          <div class="profile-selector">
            @for (profile of profiles; track profile) {
              <div
                class="profile-card"
                [class.selected]="profileCtrl.value === profile"
                (click)="profileCtrl.setValue(profile)">
                <div class="profile-header">
                  <mat-icon>{{ getProfileIcon(profile) }}</mat-icon>
                  <span class="profile-name">{{ getProfileLabel(profile) }}</span>
                </div>
                <p class="profile-description">{{ getProfileDescription(profile) }}</p>
              </div>
            }
          </div>

          <mat-error *ngIf="profileCtrl.invalid && profileCtrl.touched" class="profile-error">
            {{ profileError }}
          </mat-error>
        </div>

        <!-- Section Mot de passe -->
        <div class="form-section">
          <h2>
            <mat-icon>lock</mat-icon>
            {{ editMode ? 'Modifier le mot de passe (optionnel)' : 'Mot de passe' }}
          </h2>

          @if (editMode) {
            <div class="password-info">
              <mat-icon>info</mat-icon>
              <span>Laissez vide si vous ne souhaitez pas modifier le mot de passe</span>
            </div>
          }

          <div class="grid-two">
            <mat-form-field appearance="outline">
              <mat-label>Mot de passe</mat-label>
              <input
                matInput
                [type]="hidePassword ? 'password' : 'text'"
                formControlName="password"
                placeholder="Minimum 8 caractères">
              <mat-error *ngIf="passwordCtrl.invalid && passwordCtrl.touched">
                {{ passwordError }}
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Confirmer le mot de passe</mat-label>
              <input
                matInput
                [type]="hideConfirmPassword ? 'password' : 'text'"
                formControlName="confirmPassword">
              <mat-error *ngIf="confirmPasswordCtrl.invalid && confirmPasswordCtrl.touched">
                {{ confirmPasswordError }}
              </mat-error>
            </mat-form-field>
          </div>
        </div>
      </div>

      <!-- Boutons d'action -->
      <div class="form-actions">
        <button
          class="btn--primary"
          type="submit"
          [disabled]="(loading$ | async) || supervisorForm.invalid">
          @if (loading$ | async) {
            <mat-progress-spinner diameter="20" mode="indeterminate"></mat-progress-spinner>
          } @else {
            <mat-icon>{{ editMode ? 'save' : 'person_add' }}</mat-icon>
          }
          <span>{{ editMode ? 'Mettre à jour' : 'Créer le superviseur' }}</span>
        </button>

        <button
          class="btn--secondary"
          type="button"
          (click)="resetForm()"
          [disabled]="loading$ | async">
          <mat-icon>refresh</mat-icon>
          <span>Réinitialiser</span>
        </button>

        <button
          class="btn--cancel"
          type="button"
          (click)="cancel()"
          [disabled]="loading$ | async">
          <span>Annuler</span>
        </button>
      </div>
    </form>
  </div>
</div>
