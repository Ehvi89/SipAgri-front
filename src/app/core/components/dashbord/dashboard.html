<div class="dashboard-container">
  <app-header placeholder="" [breadcrumb]="true" [export]="true"></app-header>

  <div class="content">
    <div class="overview-card">
      @for (resume of resumes$ | async; track resume.name) {
        <div class="stat">
          <span class="stat-title">{{ resume.name }}</span>
          <span class="stat-value">{{ resume.value }}</span>
          <span class="hint">{{ resume.monthlyValue }}</span>
        </div>
      }
    </div>

    <div class="actions-buttons">
      <button routerLink="/planters/new" class="action-button">
        <mat-icon class="button-icon">person_add</mat-icon>
        <span>Ajouter un planteur</span>
      </button>
      <button routerLink="/plantations/add" class="action-button">
        <i class="fas fa-tractor button-icon"></i>
        <span>Ajouter une plantation</span>
      </button>
      <button routerLink="/productions/add" class="action-button">
        <i class="fas fa-wheat-awn button-icon"></i>
        <span>Ajouter une production</span>
      </button>
    </div>

    <div class="graphics">
      <div class="grid">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Production par période</span>
            <mat-form-field appearance="outline" class="filter-select">
              <mat-select [(value)]="selectedPeriodFilter" (selectionChange)="onPeriodFilterChange()">
                @for (filter of periodFilters; track filter.value) {
                  <mat-option [value]="filter.value">{{ filter.label }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          </div>
          <div class="chart">
            <!-- Canvas toujours présent -->
            <canvas #barCanvas [style.display]="productionByPeriod && productionByPeriod.length > 0 ? 'block' : 'none'"></canvas>

            @if (!productionByPeriod || productionByPeriod.length === 0) {
              <div class="chart-loading">
                <mat-spinner diameter="24"></mat-spinner>
                <span>Chargement des données...</span>
              </div>
            }
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <span class="card-title">Production par plantation</span>
          </div>
          <div class="chart">
            <!-- Canvas toujours présent -->
            <canvas #pieCanvas [style.display]="productionByPlantation.length > 0 ? 'block' : 'none'"></canvas>

            @if (productionByPlantation.length === 0) {
              <div class="chart-loading">
                <mat-spinner diameter="24"></mat-spinner>
                <span>Chargement des données...</span>
              </div>
            }
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card">
          <div class="card-header">
            <span class="card-title">Tendance de production</span>
            <div class="card-subtitle">Évolution sur les 12 derniers mois</div>
          </div>
          <div class="chart">
            <!-- Canvas toujours présent -->
            <canvas #lineCanvas [style.display]="productionTrend.length > 0 ? 'block' : 'none'"></canvas>

            @if (productionTrend.length === 0) {
              <div class="chart-loading">
                <mat-spinner diameter="24"></mat-spinner>
                <span>Chargement des données...</span>
              </div>
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
